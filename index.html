<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>PHRQL SMART App Client</title>

</head>
<body>

    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <script type="text/javascript">
        import Cookies from 'js-cookie';
        this.patient = "";
        this.immunizations = "";
        this.allergies = "";
        this.patientVitals = "";
        sessionid = getCookie("sessionid");
        console.log("sessionid", sessionid);
        csrfToken = getCookie("csrftoken");
        console.log("csrftoken", csrfToken);
        doAPICall('https://fs-api.phrqltest.com/api/patient-info/10?withCredentials=true', csrfToken, 'application/json', 'application/json')


        //loginUserWitOauth(); //login to PHRQL
        // console.log(client);

        function getCookie(name) {
            // Split cookie string and get all individual name=value pairs in an array
            var cookieArr = document.cookie.split(";");
            console.log("cookieList=", document.cookie);
            // Loop through the array elements
            for (var i = 0; i < cookieArr.length; i++) {
                var cookiePair = cookieArr[i].split("=");

                /* Removing whitespace at the beginning of the cookie name
                and compare it with the given string */
                if (name == cookiePair[0].trim()) {
                    // Decode the cookie value and return
                    console.log(decodeURIComponent(cookiePair[1]));
                    return decodeURIComponent(cookiePair[1]);
                }
            }

            // Return null if not found
            return null;
        }
        async function doAPICall(relativeURL, token, contentType, acceptType) {
            


            var raw = "";

            response = fetch(url, {
                method: 'get',
                headers: {
                    'Content-Type': contentType,
                    'X-CSRFToken': Cookies.get('csrftoken')
                }
            }
                .then(response => response.json())
                .then(result => { console.log(result); return result; });

            
        }


        let data = {};
        const myPromise = new Promise((resolve, reject) => {

            console.log('resolving the promise ...');

            data = doAPICall(relativeURL, token, "application/json", "application/json");
            resolve(data);

            reject(new Error('In 10% of the cases, It fail Miserably.'));
        });


        console.log(data);

        myPromise.then((resolvedValue) => {
            /// write your code here

            console.log('Resolved', resolvedValue);
        }, (error) => {
            console.log(error);
        });
        domain = "accounts-phrqltest";
        region = "us-west-2";
        state = "";
        appClientId = "118a1qur3i4k7jpf4drf2nd7v7";
                //this.redirectURI = "https://priceless-mclean-588366.netlify.app/";




    </script>
</body>
</html>
